{
  "master": {
    "tasks": [
      {
        "id": 1,
        "title": "Database schema expansion for Quick Dump queue and medical features",
        "description": "Add quick_dumps table and extend cards/notes tables to support medical list processing, partial credit, response time tracking, and connection suggestions",
        "details": "",
        "testStrategy": "",
        "priority": "high",
        "dependencies": [],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Create quick_dumps table schema and migration logic",
            "description": "Add quick_dumps table to database.ts with proper schema, types, and version migration from user_version=1 to user_version=2",
            "dependencies": [],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Extend cards table with medical feature columns",
            "description": "Add cardType, parentListId, and listPosition columns to cards table through schema migration",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 3,
            "title": "Extend review_logs table with performance tracking columns",
            "description": "Add responseTimeMs and partialCreditScore columns to review_logs table for tracking review performance metrics",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 4,
            "title": "Create connections table for semantic note relationships",
            "description": "Add connections table to store semantic relationships between notes with similarity scores",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 5,
            "title": "Implement query functions and IPC handlers for new tables",
            "description": "Create quickDumpQueries and connectionQueries objects, add corresponding IPC handlers in ipc-handlers.ts, and expose via preload.ts",
            "dependencies": [
              1,
              2,
              3,
              4
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          }
        ],
        "updatedAt": "2026-01-05T00:05:06.017Z"
      },
      {
        "id": 2,
        "title": "AI service integration layer",
        "description": "Create local-first AI service with Ollama auto-detection, cloud fallbacks (OpenAI, DeepSeek, Anthropic), concept extraction, card format suggestions, and medical content processing",
        "details": "",
        "testStrategy": "",
        "priority": "high",
        "dependencies": [
          "1"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Create AI provider abstraction and type definitions",
            "description": "Set up local-first provider detection, OpenAI-compatible SDK configuration, and all AI-related types",
            "dependencies": [],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-05T01:12:15.700Z"
          },
          {
            "id": 2,
            "title": "Implement concept extraction and card validation functions",
            "description": "Build extractConcepts and validateCard functions with provider-aware timeout and retry logic",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-05T01:15:33.268Z"
          },
          {
            "id": 3,
            "title": "Implement medical list detection and vignette conversion",
            "description": "Create functions to detect medical lists and convert list items to clinical vignettes",
            "dependencies": [
              1,
              2
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-05T01:17:15.711Z"
          },
          {
            "id": 4,
            "title": "Implement tag suggestions and semantic similarity search",
            "description": "Build AI-powered tag suggestion and note similarity matching functions",
            "dependencies": [
              1,
              2
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-05T01:19:43.555Z"
          },
          {
            "id": 5,
            "title": "Add caching layer and IPC handlers for AI service",
            "description": "Implement 5-minute result caching, provider status, and integrate AI service with IPC layer",
            "dependencies": [
              2,
              3,
              4
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-05T01:22:53.351Z"
          }
        ],
        "updatedAt": "2026-01-05T01:22:53.351Z"
      },
      {
        "id": 3,
        "title": "[ARCHIVED] AI-guided capture interface (v1)",
        "description": "ARCHIVED: v1 capture flow with AI concept extraction checkboxes. Superseded by v2 Two-Mode Capture (T118). Kept for historical reference.",
        "details": "Original flow: paste → AI extracts concepts → checkboxes → format suggestion → batch card creation. v2 uses simpler Save to Inbox flow.",
        "testStrategy": "",
        "priority": "low",
        "dependencies": [
          "2"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-05T14:29:44.672Z"
      },
      {
        "id": 5,
        "title": "Zero-decision review interface (eliminate grading buttons)",
        "description": "Replace 4-button grading (Again/Hard/Good/Easy) with Show Answer → Continue flow, letting FSRS auto-schedule based on response time",
        "details": "",
        "testStrategy": "",
        "priority": "high",
        "dependencies": [
          "1"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Remove grading buttons and interval preview UI",
            "description": "Remove the 4-button grading interface (Again/Hard/Good/Easy) and interval previews from ReviewInterface.tsx",
            "dependencies": [],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T00:32:13.586Z"
          },
          {
            "id": 2,
            "title": "Implement Show Answer → Continue flow with response time tracking",
            "description": "Replace grading buttons with single Continue button and add response time tracking from card shown to Continue pressed",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T00:32:13.591Z"
          },
          {
            "id": 3,
            "title": "Implement auto-rating algorithm based on response time",
            "description": "Create algorithm to automatically determine Rating based on response time: <5s=Easy, 5-15s=Good, 15-30s=Hard, >30s=Again",
            "dependencies": [
              2
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T00:32:13.595Z"
          },
          {
            "id": 4,
            "title": "Update scheduleReview to accept and store responseTimeMs",
            "description": "Modify scheduleReview function and review_logs table to accept and persist response time in milliseconds",
            "dependencies": [
              3
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T00:32:13.598Z"
          },
          {
            "id": 5,
            "title": "UI cleanup and zero-decision interface verification",
            "description": "Clean up UI after removing grading buttons, verify progress bar and session stats work, ensure FSRS performance <100ms",
            "dependencies": [
              4
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T00:32:13.600Z"
          },
          {
            "id": 6,
            "title": "Auto-grade animation feedback display",
            "description": "Show brief visual feedback of the auto-determined grade (Easy/Good/Hard/Again) for ~1 second after Continue pressed, before advancing to next card",
            "dependencies": [
              5
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T00:32:13.603Z"
          },
          {
            "id": 7,
            "title": "Quick override mechanism during feedback display",
            "description": "Allow user to override auto-grade during the 1-second feedback window using keyboard shortcuts (1-4) or clicking alternative grades",
            "dependencies": [
              6
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T00:32:13.607Z"
          }
        ],
        "updatedAt": "2026-01-06T00:32:13.607Z"
      },
      {
        "id": 10,
        "title": "Global search with <200ms response time",
        "description": "Implement fast unified search across cards and notes with FTS5 full-text search, Cmd+F shortcut, instant results",
        "details": "",
        "testStrategy": "",
        "priority": "high",
        "dependencies": [
          "1"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Create FTS5 virtual tables for cards, notes, and source_items with sync triggers",
            "description": "Implement FTS5 full-text search tables with automatic synchronization triggers for all searchable content",
            "dependencies": [],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Implement searchQueries.search() with filter support and performance tracking",
            "description": "Create unified search function that queries all FTS tables with filter options (all/cards/notes/inbox) and tracks response time",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 3,
            "title": "Add IPC handler, preload exposure, and TypeScript types for search",
            "description": "Wire up search functionality through IPC layer with proper type definitions",
            "dependencies": [
              2
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 4,
            "title": "Build basic SearchBar component with debounced query and results dropdown",
            "description": "Replace placeholder SearchBar with functional component that performs real-time search with debounced input and displays top 10 results in dropdown",
            "dependencies": [
              3
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 5,
            "title": "Add horizontal filter chips UI with toggleable selection and count badges",
            "description": "Implement filter chip buttons (All/Cards/Notes/Inbox) above search results with active state and result counts",
            "dependencies": [
              4
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 6,
            "title": "Implement keyboard navigation and Ctrl+F global shortcut",
            "description": "Add full keyboard support for search including Up/Down/Enter/Escape navigation and global Ctrl+F hotkey to focus search bar",
            "dependencies": [
              5
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 7,
            "title": "Add search term highlighting in result snippets",
            "description": "Implement visual highlighting of matched search terms in result text using FTS5 snippet() function",
            "dependencies": [
              4
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 8,
            "title": "Create full SearchResults page component with sections and view-all navigation",
            "description": "Build dedicated full-page search results view with categorized sections, showing all matches beyond the 10-result dropdown limit",
            "dependencies": [
              7
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          }
        ],
        "updatedAt": "2026-01-06T05:12:32.737Z"
      },
      {
        "id": 17,
        "title": "Auto-start Ollama from Electron on first AI request",
        "description": "Automatically start Ollama when the app needs AI services, eliminating the friction of manually starting Ollama before using the app",
        "details": "",
        "testStrategy": "",
        "priority": "high",
        "dependencies": [
          "2"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Implement ensureOllamaRunning() function with process spawning",
            "description": "Create function to check Ollama status and spawn it if not running",
            "dependencies": [],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Integrate auto-start into AI client initialization",
            "description": "Update initializeClient() to call ensureOllamaRunning() when Ollama provider is detected",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 3,
            "title": "Add user notification for Ollama status via IPC",
            "description": "Notify renderer process about Ollama auto-start status so user sees feedback",
            "dependencies": [
              2
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 4,
            "title": "Handle cross-platform Ollama executable detection",
            "description": "Ensure Ollama can be found and started on Windows, macOS, and Linux",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          }
        ],
        "updatedAt": "2026-01-06T05:29:32.390Z"
      },
      {
        "id": 31,
        "title": "BUG FIX: Quick Dump saves to notes table instead of quick_dumps table",
        "description": "QuickDumpModal incorrectly saves content as a regular note instead of to the quick_dumps table, breaking the extraction queue workflow",
        "details": "",
        "testStrategy": "",
        "priority": "high",
        "dependencies": [
          "1"
        ],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-06T02:11:06.148Z"
      },
      {
        "id": 35,
        "title": "[v2-T1] Data model v3: SourceItem, CanonicalTopic, NotebookTopicPage, SmartView schemas",
        "description": "Implement the v2 architecture data model with new tables for 3-layer system: Knowledge Bank (SourceItem), Notebook (NotebookTopicPage, NotebookBlock), and enhanced Cards with provenance. Add CanonicalTopic for topic normalization and SmartView for filtered access.",
        "details": "",
        "testStrategy": "",
        "priority": "high",
        "dependencies": [],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Define TypeScript interfaces for v3 data model",
            "description": "Create TypeScript interfaces in src/types/index.ts for SourceItem, CanonicalTopic, NotebookTopicPage, NotebookBlock, SmartView, and SmartViewFilter. Update Card interface with optional provenance fields.",
            "dependencies": [],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Create database schema v3 with migration from v2",
            "description": "Implement new tables (source_items, canonical_topics, notebook_topic_pages, notebook_blocks, smart_views) in electron/database.ts with migration from schema v2 to v3.",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 3,
            "title": "Implement CRUD functions for new tables",
            "description": "Add database query functions for SourceItem, NotebookTopicPage, NotebookBlock, CanonicalTopic, and SmartView in electron/database.ts following existing pattern.",
            "dependencies": [
              2
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 4,
            "title": "Wire IPC handlers for new CRUD operations",
            "description": "Register IPC handlers in ipc-handlers.ts, expose via preload.ts, and declare types in electron.d.ts for all new database operations.",
            "dependencies": [
              3
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 5,
            "title": "Update test helpers with new schema",
            "description": "Add new table creation to tests/helpers/db-helpers.ts ensuring test database schema matches production v3 schema.",
            "dependencies": [
              2
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          }
        ]
      },
      {
        "id": 36,
        "title": "[v2-T1.1] Topic normalization: alias table, matching rules, dedupe prevention",
        "description": "Implement topic alias matching system that normalizes user input to canonical topics. 'HOCM', 'HCM', 'hypertrophic cardiomyopathy' should all resolve to the same CanonicalTopic.",
        "details": "",
        "testStrategy": "",
        "priority": "high",
        "dependencies": [
          "35"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Create electron/topic-service.ts with core alias resolution functions",
            "description": "Implement resolveTopicAlias() and createOrGetTopic() functions for basic topic alias lookup and creation with automatic alias generation",
            "dependencies": [],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "updatedAt": "2026-01-06T14:43:34.428Z",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Implement suggestTopicMatches() with fuzzy search for autocomplete",
            "description": "Add fuzzy search function to suggest topic matches using simple string similarity for autocomplete dropdown",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T14:54:58.758Z"
          },
          {
            "id": 3,
            "title": "Implement addTopicAlias() with uniqueness validation",
            "description": "Add function to add new aliases to existing topics with duplicate prevention across all topics",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T15:05:57.395Z"
          },
          {
            "id": 4,
            "title": "Implement mergeTopics() with transactional safety and reference updates",
            "description": "Add topic merging function that consolidates aliases and updates all references in source_items and notebook_topic_pages tables",
            "dependencies": [
              1,
              3
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T15:37:46.360Z"
          },
          {
            "id": 5,
            "title": "Wire IPC handlers and create TopicAutocomplete UI component",
            "description": "Register IPC handlers for topic operations and build React autocomplete component with debounced search and dropdown suggestions",
            "dependencies": [
              1,
              2,
              3,
              4
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T15:44:32.497Z"
          }
        ],
        "updatedAt": "2026-01-06T15:44:32.497Z"
      },
      {
        "id": 38,
        "title": "[v2-T2] Capture pipeline: Quick Dump → SourceItem (inbox), text + image support",
        "description": "Implement capture flow that creates SourceItems in Knowledge Bank with inbox status. Support text paste and image paste/drop.",
        "details": "TEXT CAPTURE: Complete ✓. IMAGE CAPTURE: NOT IMPLEMENTED (T38.2-T38.3 pending). Database supports images but UI lacks handlers.",
        "testStrategy": "Test text capture (working), test image capture (pending)",
        "priority": "high",
        "dependencies": [
          "35"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Update QuickDumpModal to create SourceItems instead of QuickDumps",
            "description": "Refactor QuickDumpModal.tsx to use sourceItems.create API, mapping text content to SourceItem schema with sourceType='quickcapture' and status='inbox'.",
            "dependencies": [],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T02:38:03.709Z"
          },
          {
            "id": 2,
            "title": "Add image paste/drop support to QuickDumpModal",
            "description": "Implement clipboard paste and drag-drop handlers for images in QuickDumpModal, with visual preview and content type detection.",
            "dependencies": [
              1
            ],
            "details": "CRITICAL: NOT IMPLEMENTED. T38.2 was marked DONE incorrectly. QuickDumpModal only handles text paste (clipboardData.getData('text')). No image handlers exist for clipboardData.files or clipboardData.items. Database schema supports images (imageData BLOB) but UI does not.",
            "status": "cancelled",
            "testStrategy": "Test image paste from clipboard, drag-drop image files, verify preview displays, confirm imageData saves to DB",
            "parentId": "undefined",
            "updatedAt": "2026-01-07T00:32:52.755Z"
          },
          {
            "id": 3,
            "title": "Implement image file storage and mediaPath handling",
            "description": "Create IPC handler for saving image files to app data directory and returning relative path for mediaPath field.",
            "dependencies": [
              2
            ],
            "details": "Depends on T38.2. No IPC handlers exist for image save operations. Need: saveImage(buffer) IPC handler, file storage in app.getPath('userData')/images/, return mediaPath for DB storage.",
            "status": "cancelled",
            "testStrategy": "Save image via IPC, verify file exists in userData/images/, confirm mediaPath stored in sourceItems table, test image retrieval",
            "parentId": "undefined",
            "updatedAt": "2026-01-07T00:32:52.758Z"
          },
          {
            "id": 4,
            "title": "Add inboxCount state management to useAppStore",
            "description": "Extend useAppStore with inboxCount state that queries source_items table for items with status='inbox', and refreshes after captures.",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "updatedAt": "2026-01-06T02:33:30.360Z",
            "parentId": "undefined"
          },
          {
            "id": 5,
            "title": "Wire Sidebar to display inbox badge count from useAppStore",
            "description": "Connect Sidebar component to useAppStore.inboxCount and replace hardcoded inboxCount=0 with live state.",
            "dependencies": [
              4
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T02:33:30.460Z"
          }
        ],
        "updatedAt": "2026-01-07T00:32:56.159Z"
      },
      {
        "id": 40,
        "title": "[v2-T3] Knowledge Bank UI: vertical list grouped by status, search, filters",
        "description": "Build the main Knowledge Bank view showing all SourceItems organized by status with filtering and search capabilities.",
        "details": "",
        "testStrategy": "",
        "priority": "high",
        "dependencies": [
          "39"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Create StatusGroup collapsible component (COMPLETE)",
            "description": "StatusGroup.tsx component is already complete with collapsible status sections, badge styling, and chevron animations.",
            "dependencies": [],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Create KnowledgeBankView with status-grouped layout",
            "description": "Build main Knowledge Bank view component fetching all SourceItems and organizing them into 3 collapsible StatusGroup sections (Inbox, Processed, Curated) using existing row components.",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "updatedAt": "2026-01-06T20:44:26.020Z",
            "parentId": "undefined"
          },
          {
            "id": 3,
            "title": "Add search and filter controls to KnowledgeBankView",
            "description": "Implement real-time search input (debounced 200ms) and multi-select filters (status, source type) with AND logic to filter visible items in Knowledge Bank.",
            "dependencies": [
              2
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T20:57:59.367Z"
          }
        ],
        "updatedAt": "2026-01-06T20:57:59.367Z"
      },
      {
        "id": 41,
        "title": "[v2-T4] Notebook UI: topic pages, add blocks from sources, enforce card-creation here only",
        "description": "Build the Notebook layer with topic pages containing blocks from Knowledge Bank. This is the ONLY place where cards can be created.",
        "details": "NOTEBOOK VIEW:\n\n1. TOPIC PAGE LIST:\n- Sidebar or list showing all NotebookTopicPages\n- Show: topic name, aliases, card count, source count\n- Search/filter by topic name\n- 'New Topic Page' button\n\n2. TOPIC PAGE VIEW:\n- Header: Topic name, aliases, stats\n- Blocks section: excerpts from SourceItems\n- Each block shows:\n  - Source reference (clickable deep link)\n  - Content excerpt\n  - Annotations (user notes)\n  - Actions: [Edit] [→ Source] [Generate Card]\n- Footer: [+ Add from Knowledge Bank] [Generate All Cards]\n\n3. ADD BLOCK FLOW:\n- Click '+ Add from Knowledge Bank'\n- Modal shows Knowledge Bank filtered to curated/processed\n- Select source item\n- Select excerpt (highlight text) or use full content\n- Save creates NotebookBlock linked to source\n- SourceItem status → 'curated'\n\n4. BLOCK MANAGEMENT:\n- Drag to reorder blocks (position field)\n- Edit block content (excerpt)\n- Add annotations\n- Delete block (doesn't delete source)\n\nCARD CREATION ENFORCED:\n- 'Generate Card' button ONLY appears on blocks\n- No card creation in Knowledge Bank\n- No card creation from scratch\n- All cards have notebookTopicPageId (enforced)\n\nCOMPONENTS:\n\n- src/components/notebook/NotebookView.tsx\n- src/components/notebook/TopicPageList.tsx\n- src/components/notebook/TopicPageView.tsx\n- src/components/notebook/NotebookBlock.tsx\n- src/components/notebook/AddBlockModal.tsx",
        "testStrategy": "Create topic page, add block from source, verify deep link works. Generate card from block, verify card has notebookTopicPageId. Verify no way to create card outside Notebook.",
        "priority": "high",
        "dependencies": [
          "40",
          "36"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Create NotebookView container component with routing integration",
            "description": "NotebookView.tsx renders when currentView='notebook'. Pattern: KnowledgeBankView.tsx",
            "dependencies": [],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Build TopicPageList sidebar with search and new topic creation",
            "description": "TopicPageList.tsx shows all topics with search. 'New Topic Page' uses TopicAutocomplete dialog.",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 3,
            "title": "Build TopicPageView with header, stats, and blocks list",
            "description": "TopicPageView.tsx shows topic header (name, aliases, stats) + NotebookBlock list + footer actions.",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 4,
            "title": "Create NotebookBlock component with source deep link and actions",
            "description": "NotebookBlock.tsx: Card with content, source deep link, [Edit] [→ Source] [Generate Card] actions.",
            "dependencies": [
              3
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 5,
            "title": "Build AddBlockModal for selecting sources from Knowledge Bank",
            "description": "AddBlockModal.tsx: Select processed/curated SourceItems, create NotebookBlock, update status to curated.",
            "dependencies": [
              3
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 6,
            "title": "Wire up Notebook view navigation and integrate with app routing",
            "description": "AppLayout routing, sidebar navigation, notebook count badge in useAppStore.",
            "dependencies": [
              2,
              3,
              4,
              5
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          }
        ],
        "updatedAt": "2026-01-07T02:21:03.685Z"
      },
      {
        "id": 42,
        "title": "Card Generation from Notebook Blocks",
        "description": "Select text in NotebookBlock → AI suggests cards with format intelligence and card-worthiness feedback → user confirms → card created with provenance. Post-creation: blocks with cards show muted visual indicator.",
        "details": "CORE PHILOSOPHY:\nThe Notebook is the 'What Boards Test' registry—curated, clinically-relevant content. Card generation treats text selection as a conversation starter with AI, not a binding specification. User identifies what confuses them; AI becomes collaborative tutor evaluating whether confusion merits a flashcard.\n\nINTERACTION FLOW:\n1. HOVER & SELECT:\n- Hover over text in NotebookBlock shows subtle highlight\n- Click activates selection mode with context-aware bounding box (expands to semantic units: sentences, clinical facts, procedural steps)\n- Floating 'Generate Card' button anchors to selection\n- Click-to-activate prevents accidental triggers\n\n2. AI CONTEXT STRATEGY:\n- Full NotebookBlock content as context (prevents 'lost in the middle')\n- Highlighted portion marked with semantic emphasis\n- Optional 'Why do you want to learn this?' text field (teaching moment + format hint)\n- If user writes 'I keep confusing X with Y' → AI suggests discriminative format\n\n3. FORMAT INTELLIGENCE:\nAI auto-suggests one of five formats with visual explanation:\n- Clinical Vignette Q&A: diagnostic reasoning\n- Overlapping Cloze: lists that risk sibling contamination\n- Single-Fact Cloze: discrete knowledge\n- Image Occlusion: when images referenced\n- Procedural Sequential: step-based skills\nFormat shown as labeled dropdown, default is AI suggestion, instant override available.\n\n4. CARD-WORTHINESS SOFT-GATE (integrated, not separate F6):\n- Quality panel shows 3 traffic lights: Testable? One Concept? Discriminative?\n- Yellow/red indicators have expandable explanation panel\n- Options: [Edit First] [Create Anyway] (tracked) [Skip]\n- Teaches effective card design through use, not blocking\n\n5. PROCEDURAL CARDS (MVP):\n- AI detects procedural content (keywords: steps, procedure, technique, how to)\n- Generates two-part card: Front=supplies checklist (pre-revealed), Back=numbered steps\n- Uses standard card template; voice-activated equipment reveal deferred (see DEFERRED: Procedural Simulation Mode)\n\n6. CARD CREATION:\n- Card saved with: notebookTopicPageId, sourceBlockId, tags from topic, FSRS defaults\n- Toast: 'Card created' with [View] link\n- NotebookBlock shows muted visual indicator (subtle box around text) showing content has been turned into card(s)\n- Indicator is non-distracting (muted colors, optional hover to reveal)\n\n7. USER TEACHING MOMENTS:\n- When user creates basic list card, card-worthiness flags it\n- AI offers auto-generate improved versions (overlapping cloze, individual vignettes)\n\nPERFORMANCE TARGET:\n- Text selection to created card: <20 seconds including AI processing\n- Optimistic UI: AI thinking indicator immediately, streaming preview updates, editable fields before AI completes\n- Database writes async after Create click, local state updates first\n\nCOMPONENTS:\n- src/components/notebook/CardGenerationModal.tsx\n- src/components/notebook/CardSuggestionPreview.tsx\n- src/components/notebook/FormatSelector.tsx\n- src/components/notebook/CardWorthinessPanel.tsx\n- Update NotebookBlock.tsx: Add selection handling + card indicator styling\n\nAI FUNCTIONS in electron/ai-service.ts:\n- generateCardFromBlock(blockContent: string, topicContext: string, userIntent?: string): Promise<CardSuggestion[]>\n- evaluateCardWorthiness(cardContent: string): Promise<WorthinessResult>",
        "testStrategy": "1. Hover text in block, verify highlight appears. 2. Select text, verify Generate Card button anchors. 3. Generate card from medical fact, verify AI suggests appropriate format. 4. Create list card, verify card-worthiness warning appears. 5. Create card, verify provenance fields (notebookTopicPageId, sourceBlockId). 6. Verify block shows muted indicator after card creation. 7. Performance: <20s from selection to created card.",
        "priority": "high",
        "dependencies": [
          "41"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Define CardSuggestion types and AI generateCardFromBlock function",
            "description": "Create CardSuggestion type (format, front, back, confidence, worthinessResult) in src/types/ai.ts. Implement generateCardFromBlock() in ai-service.ts with format detection logic (QA, Cloze, Vignette, ImageOcclusion, Procedural). Handle procedural keyword detection, list detection for overlapping cloze. Put highlighted text at START of context window to avoid 'lost in the middle' issue.",
            "dependencies": [],
            "details": "Format detection heuristics: procedural keywords (steps, procedure, technique, how to), list patterns for overlapping cloze, clinical vignette triggers. Return array for multi-card suggestions from lists.",
            "status": "done",
            "testStrategy": "Unit test with sample medical content: clinical fact → QA, list of causes → overlapping cloze, procedure steps → procedural format.",
            "updatedAt": "2026-01-07T23:30:16.319Z",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Wire IPC handler for ai:generateCardFromBlock",
            "description": "Add ai:generateCardFromBlock handler in ipc-handlers.ts, expose in preload.ts, add type to electron.d.ts. Handler calls ai-service.generateCardFromBlock() with blockContent, topicContext, optional userIntent.",
            "dependencies": [
              1
            ],
            "details": "Cache key should include blockId to avoid regenerating. Return CardSuggestion[] to renderer.",
            "status": "done",
            "testStrategy": "Call from renderer, verify CardSuggestion[] returns with correct format.",
            "parentId": "undefined",
            "updatedAt": "2026-01-07T23:30:16.322Z"
          },
          {
            "id": 3,
            "title": "Build CardGenerationModal with FormatSelector and preview",
            "description": "Create CardGenerationModal.tsx with: optional 'Why do you want to learn this?' textarea, FormatSelector.tsx dropdown (5 formats with visual labels), CardSuggestionPreview.tsx showing front/back. Streaming UI: show AI thinking indicator immediately, update preview as response arrives. Buttons: [Edit First] [Create Card] [Skip].",
            "dependencies": [
              1
            ],
            "details": "Modal receives selectedText and blockId as props. Format dropdown defaults to AI suggestion but allows override. Preview shows editable front/back fields.",
            "status": "done",
            "testStrategy": "Open modal with test text, verify format selector works, edit preview fields, confirm buttons work.",
            "parentId": "undefined",
            "updatedAt": "2026-01-07T23:44:25.533Z"
          },
          {
            "id": 4,
            "title": "Build CardWorthinessPanel with traffic-light feedback",
            "description": "Create CardWorthinessPanel.tsx with compact traffic-light strip showing 3 criteria. Each criterion has green/yellow/red indicator with expandable explanation. Track [Create Anyway] clicks for analytics.",
            "dependencies": [
              1
            ],
            "details": "THREE CRITERIA:\n\n1. TESTABLE - Has one clear correct answer; survives rephrasing\n   Pass: 'What marker rises first in MI?' → Troponin\n   Fail: 'Describe MI pathophysiology' (essay, no single answer)\n\n2. ONE CONCEPT - Tests exactly one retrievable fact\n   Pass: 'Door-to-balloon target?' → <90 min\n   Fail: 'Name 5 STEMI criteria' (list = multiple facts)\n\n3. DISCRIMINATIVE - Distinguishes from similar concepts\n   Pass: 'Troponin vs CK-MB timing?' (forces comparison)\n   Fail: 'What's a cardiac marker?' (too generic, no discrimination)\n\nUI: Compact traffic-light strip (horizontal row of 3 circles). Hover/click on indicator → expands explanation panel with pass/fail examples. Yellow = borderline, Red = clear violation. Teaching moment: when red, suggest alternative format (e.g., 'Consider overlapping cloze for lists').",
            "status": "done",
            "testStrategy": "Test with: (1) 'Name 5 causes of chest pain' → One Concept should be red, (2) 'Describe pathophysiology of MI' → Testable should be red, (3) 'What is a troponin?' → Discriminative should be yellow, (4) 'Troponin rises before CK-MB. True/False?' → All green.",
            "parentId": "undefined",
            "updatedAt": "2026-01-07T23:37:56.504Z"
          },
          {
            "id": 5,
            "title": "Add text selection UI to NotebookBlock",
            "description": "Add hover highlight effect on NotebookBlock text (subtle, context-aware bounding). Click-to-activate selection mode. Floating 'Generate Card' button anchored to selection. Clear selection after modal opens. Debounce selection detection for performance.",
            "dependencies": [],
            "details": "Use window.getSelection() API. Context-aware bounding expands to sentence/paragraph boundaries. Avoid modal pop-up on accidental clicks with activation delay or minimum selection length.",
            "status": "done",
            "testStrategy": "Hover text, verify highlight. Select text, verify floating button appears. Click button, verify modal opens with selection.",
            "parentId": "undefined",
            "updatedAt": "2026-01-07T23:30:16.324Z"
          },
          {
            "id": 6,
            "title": "Wire modal to IPC and card creation flow",
            "description": "Connect CardGenerationModal to ai:generateCardFromBlock IPC. On [Create Card]: call cards:create with notebookTopicPageId, sourceBlockId, front, back, format. Use transaction: insert card + update NotebookBlock.cardCount atomically. Show toast 'Card created' with [View] link.",
            "dependencies": [
              2,
              3,
              4,
              5
            ],
            "details": "FSRS defaults for new cards: state=0, reps=0, lapses=0. Card ID via crypto.randomUUID(). Performance target: <20s from selection to created card.",
            "status": "done",
            "testStrategy": "Select text, generate card, verify card in database with provenance fields. Verify toast appears.",
            "parentId": "undefined",
            "updatedAt": "2026-01-07T23:49:10.686Z"
          },
          {
            "id": 7,
            "title": "Add muted indicator styling for blocks with cards",
            "description": "NotebookBlock shows visual indicator when cardCount > 0. Muted, non-distracting styling (subtle left border or background tint). Optional hover to reveal 'X cards created from this block'. Update cardCount badge in real-time after card creation.",
            "dependencies": [
              6
            ],
            "details": "Consider: subtle left border (2px muted color), or very light background overlay. Badge shows count. Hover reveals list of linked cards.",
            "status": "done",
            "testStrategy": "Create card from block, verify indicator appears. Verify cardCount badge updates without page refresh.",
            "parentId": "undefined",
            "updatedAt": "2026-01-07T23:49:10.694Z"
          }
        ],
        "updatedAt": "2026-01-07T23:49:10.694Z"
      },
      {
        "id": 44,
        "title": "[v2-T8] Smart Views: system views (Inbox, Today, Queue, Weak Topics), filter engine",
        "description": "Implement Smart Views system with preset system views and a reusable filter engine for dynamic list filtering.",
        "details": "",
        "testStrategy": "",
        "priority": "high",
        "dependencies": [
          "35"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Create filter engine types and applyFilter() function",
            "description": "Implement reusable filter engine with SmartViewFilter interface and applyFilter() function in new src/lib/filter-engine.ts file.",
            "dependencies": [],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T20:57:59.462Z"
          },
          {
            "id": 2,
            "title": "Define system view configurations (Inbox, Today, Queue, Weak Topics)",
            "description": "Create system view definitions with filter configs, icons, and sort rules in src/lib/system-views.ts using SmartView type.",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T21:12:10.382Z"
          },
          {
            "id": 3,
            "title": "Build SmartViewSidebar component with view list UI",
            "description": "Create SmartViewSidebar component in src/components/layout/SmartViewSidebar.tsx displaying system views with icons, badges, and click handlers.",
            "dependencies": [],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T20:57:59.558Z"
          },
          {
            "id": 4,
            "title": "Implement badge counts and integrate into AppLayout",
            "description": "Add reactive badge count calculation using applyFilter and integrate SmartViewSidebar into AppLayout.tsx alongside existing Sidebar.",
            "dependencies": [
              1,
              3
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined",
            "updatedAt": "2026-01-06T21:12:10.478Z"
          }
        ],
        "updatedAt": "2026-01-06T21:12:10.478Z"
      },
      {
        "id": 45,
        "title": "[v2-T6] FSRS integration: scheduling fields, review UI, response time tracking",
        "description": "Ensure FSRS integration works with new card provenance model. Track response times for future personalization.",
        "details": "FSRS FIELDS (already in cards table):\n- stability, difficulty, elapsedDays, scheduledDays\n- reps, lapses, state\n- dueDate, lastReview\n\nNEW TRACKING:\n- responseTimeMs in review_logs (already added in Task 1)\n- Track time from card shown to answer revealed\n- Track time from answer revealed to rating\n\nREVIEW UI UPDATES:\n\n1. PROVENANCE DISPLAY:\n- Show source: 'From: [Topic Name]'\n- Click to navigate to NotebookTopicPage\n- Show related cards count\n\n2. ZERO-DECISION FLOW:\n- Show Answer (Space)\n- Continue (Enter) = auto-grade based on response time\n- I Forgot (F) = grade as Again\n- Edit (E) = open card editor\n- Skip (S) = skip without grading\n\n3. LOW-EASE FLAGGING:\n- If card ease < 2.0 after review, flag for attention\n- Show in Weak Topics smart view\n- Suggest 'fix card' flow\n\nRESPONSE TIME LOGIC:\n- Fast correct (< 5s): increase ease slightly\n- Slow correct (> 15s): decrease ease slightly\n- Helps identify cards that need improvement\n\nCOMPONENTS:\n\n- Update src/components/review/ReviewInterface.tsx\n- Add response time tracking\n- Add provenance display\n- Connect to NotebookTopicPage navigation",
        "testStrategy": "Review card, verify response time logged. Test fast answer increases ease. Test slow answer decreases ease. Test low-ease card appears in Weak Topics. Test provenance link navigates correctly.",
        "priority": "high",
        "dependencies": [
          "41",
          "42"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Add provenance display in ReviewInterface with NotebookTopicPage navigation",
            "description": "Display 'From: [Topic Name]' with clickable link to navigate to the source NotebookTopicPage. Handle legacy v1 cards without notebookTopicPageId gracefully.",
            "dependencies": [],
            "details": "Update ReviewInterface.tsx to:\n1. Load CanonicalTopic name from card.notebookTopicPageId via IPC (create new handler in ipc-handlers.ts)\n2. Add database query to join NotebookTopicPage → CanonicalTopic → canonicalName\n3. Display topic name below card content in the source metadata section\n4. Make topic name clickable to navigate via setCurrentView('notebook', notebookTopicPageId)\n5. Show fallback for legacy v1 cards without notebookTopicPageId (show Note title as before)\n6. Add count of related cards from same topic page (optional enhancement)\n\nFiles to modify:\n- src/components/review/ReviewInterface.tsx (lines 419-429)\n- electron/database.ts (add getTopicNameByNotebookPageId query)\n- electron/ipc-handlers.ts (add IPC handler)\n- src/types/electron.d.ts (add IPC type definition)\n- electron/preload.ts (expose IPC method)",
            "status": "done",
            "testStrategy": "Review a card with notebookTopicPageId, verify topic name displays. Click topic link, verify navigation to NotebookTopicPage. Review legacy v1 card, verify Note title fallback displays.",
            "updatedAt": "2026-01-08T01:59:03.520Z",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Implement response-time signal for FSRS interval adjustment",
            "description": "Add explicit response-time modifier to FSRS scheduling: fast answers (<5s) get +15% interval boost, slow answers (>15s) get -15% reduction. This is a multiplier applied ON TOP of the base FSRS calculation.",
            "dependencies": [],
            "details": "Update fsrs-service.ts scheduleReview function:\n1. After FSRS calculates base interval (scheduled.card.scheduled_days), apply response-time modifier\n2. Fast response (<5000ms): multiply interval by 1.15\n3. Slow response (>15000ms): multiply interval by 0.85\n4. Normal response (5-15s): no modifier (1.0)\n5. Update scheduled.card.scheduled_days before converting to DbCard\n6. Recalculate due date from modified interval\n7. This is SEPARATE from the auto-rating logic (which maps time→rating). This adds an additional multiplier.\n8. Ensure responseTimeMs is passed through from ReviewInterface → scheduleCardReview → scheduleReview\n\nFiles to modify:\n- electron/fsrs-service.ts (scheduleReview function, lines 82-159)\n- Add helper function calculateResponseTimeModifier(responseTimeMs: number | null): number\n\nNote: Do NOT modify the auto-rating logic in ReviewInterface.tsx (lines 111-116). That stays as-is. This is an additional signal in the scheduling layer.",
            "status": "done",
            "testStrategy": "Review card with fast response (<5s), check review_logs.responseTimeMs and card.scheduledDays (should be 15% higher than base FSRS). Review with slow response (>15s), verify 15% reduction. Review with normal response, verify no modifier.",
            "parentId": "undefined",
            "updatedAt": "2026-01-08T01:59:03.523Z"
          },
          {
            "id": 3,
            "title": "Add database query for low-difficulty cards aggregated by topic",
            "description": "Create SQL query to find cards with difficulty > 8.0 (FSRS scale), aggregate by NotebookTopicPage, return counts and topic names for Weak Topics view.",
            "dependencies": [],
            "details": "Add to electron/database.ts:\n1. Create new query function getLowDifficultyCardsByTopic()\n2. SQL: JOIN cards → notebookTopicPageId → NotebookTopicPage → CanonicalTopic\n3. Filter WHERE cards.difficulty > 8.0 AND cards.notebookTopicPageId IS NOT NULL\n4. GROUP BY canonicalTopicId\n5. Return: { topicId: string, topicName: string, cardCount: number, avgDifficulty: number }[]\n6. Order by avgDifficulty DESC, cardCount DESC\n7. Add to cardQueries object\n8. Create IPC handler in ipc-handlers.ts\n9. Add type definitions in electron.d.ts and index.ts\n10. Expose in preload.ts\n\nNew interface:\nexport interface WeakTopicSummary {\n  topicId: string;\n  topicName: string;\n  cardCount: number;\n  avgDifficulty: number;\n}\n\nFiles to modify:\n- electron/database.ts (add to cardQueries)\n- electron/ipc-handlers.ts (add handler)\n- src/types/electron.d.ts\n- src/types/index.ts\n- electron/preload.ts",
            "status": "done",
            "testStrategy": "Create test cards with difficulty > 8.0 and < 8.0 linked to different topics. Call getLowDifficultyCardsByTopic(), verify only high-difficulty cards returned, grouped by topic with correct counts and avg.",
            "parentId": "undefined",
            "updatedAt": "2026-01-08T01:59:03.526Z"
          },
          {
            "id": 4,
            "title": "Add visual indicator for high-difficulty cards in ReviewInterface",
            "description": "When reviewing a card with difficulty > 8.0, show red pulsing border and 'This card needs attention' message with Edit Card suggestion.",
            "dependencies": [
              3
            ],
            "details": "Update ReviewInterface.tsx:\n1. Check currentCard.difficulty > 8.0\n2. Add conditional className to card container (line 380): if high-difficulty, add 'ring-2 ring-destructive/50 animate-pulse-subtle'\n3. Add message below card content (before source metadata): 'This card needs attention' with AlertTriangle icon\n4. Add 'Edit Card' button/link (implement card editor navigation in future task, for now just show UI)\n5. Use existing pulse-subtle animation from Tailwind config\n6. Ensure difficulty value is available in Card type (already in CardWithFSRS)\n\nFiles to modify:\n- src/components/review/ReviewInterface.tsx (lines 380-430)\n\nNote: Card difficulty is already in the Card type from FSRS fields. Just need to read it from currentCard.",
            "status": "done",
            "testStrategy": "Review card with difficulty > 8.0, verify red pulsing border and warning message display. Review card with difficulty < 8.0, verify no indicator. Verify pulse animation works smoothly.",
            "parentId": "undefined",
            "updatedAt": "2026-01-08T01:59:03.528Z"
          },
          {
            "id": 5,
            "title": "Create Weak Topics smart view component",
            "description": "Build WeakTopicsView component showing topics with high-difficulty cards, sorted by avg difficulty descending. Show card count per topic and navigation to topic page.",
            "dependencies": [
              3
            ],
            "details": "Create new component src/components/smartviews/WeakTopicsView.tsx:\n1. Fetch weak topics using window.api.cards.getLowDifficultyCardsByTopic()\n2. Display as list with:\n   - Topic name (large, bold)\n   - Card count badge\n   - Avg difficulty score (color-coded: 8-9=yellow, 9-10=red)\n   - Progress bar showing difficulty severity\n3. Click topic → navigate to NotebookTopicPage (setCurrentView('notebook', topicId))\n4. Empty state: 'No weak topics! All cards are well-learned.'\n5. Add to AppView type as 'weak-topics'\n6. Update router/view switcher to include WeakTopicsView\n7. Style consistent with existing smart views (inbox, notebook)\n\nFiles to create:\n- src/components/smartviews/WeakTopicsView.tsx\n\nFiles to modify:\n- src/types/index.ts (add 'weak-topics' to AppView if not exists)\n- src/App.tsx or view router (add weak-topics case)\n- Add icon and navigation in sidebar (future task)",
            "status": "done",
            "testStrategy": "Navigate to weak-topics view, verify topics with high-difficulty cards display. Click topic, verify navigation to topic page. Create cards with difficulty < 8.0, verify they don't appear. Test empty state when no weak topics.",
            "parentId": "undefined",
            "updatedAt": "2026-01-08T01:59:03.531Z"
          },
          {
            "id": 6,
            "title": "Add FSRS parameter optimization groundwork (schema and hooks)",
            "description": "Prepare infrastructure for Phase 3 MLE parameter training: add review_count tracking, settings table for learned parameters, and placeholder trigger logic (don't implement actual MLE yet).",
            "dependencies": [],
            "details": "Database schema updates in electron/database.ts:\n1. Add settings table if not exists:\n   CREATE TABLE settings (\n     key TEXT PRIMARY KEY,\n     value TEXT NOT NULL,\n     updatedAt TEXT NOT NULL\n   )\n2. Add migration for settings table\n3. Add settingsQueries object with get/set methods\n4. Add 'fsrs_parameters' key to store JSON of learned FSRS params\n5. Add 'review_count' key to track total reviews completed\n6. Increment review_count in scheduleReview after each review log insert\n7. Add helper function shouldTriggerOptimization(): boolean (returns true if review_count >= 400)\n8. Add placeholder comment in scheduleReview: '// TODO Phase 3: If shouldTriggerOptimization(), trigger MLE training'\n9. Create IPC handlers for settings CRUD\n10. Add types and preload exposure\n\nDO NOT implement actual MLE training algorithm. This is just the schema/hooks prep.\n\nFiles to modify:\n- electron/database.ts (add settings table migration, queries)\n- electron/fsrs-service.ts (increment review_count, add optimization check)\n- electron/ipc-handlers.ts (settings handlers)\n- src/types/electron.d.ts\n- electron/preload.ts",
            "status": "done",
            "testStrategy": "Verify settings table created. Review 5 cards, verify review_count increments to 5. Call shouldTriggerOptimization() with mock count >= 400, verify returns true. Verify fsrs_parameters can be stored and retrieved as JSON.",
            "parentId": "undefined",
            "updatedAt": "2026-01-08T01:59:03.533Z"
          }
        ],
        "updatedAt": "2026-01-08T01:59:03.533Z"
      },
      {
        "id": 91,
        "title": "Debug and Fix Ollama AI Extraction Pipeline",
        "description": "Troubleshoot and resolve AI extraction issues with Ollama integration, focusing on JSON parsing, model compatibility, and response handling in the extractConcepts() function",
        "details": "",
        "testStrategy": "",
        "priority": "high",
        "dependencies": [],
        "status": "done",
        "subtasks": [],
        "updatedAt": "2026-01-06T04:58:26.652Z"
      },
      {
        "id": 112,
        "title": "Sidebar Consolidation: merge SmartViewSidebar into Sidebar",
        "description": "Delete SmartViewSidebar.tsx, consolidate navigation into single Sidebar component with DO NOW and LIBRARY sections",
        "details": "DO NOW: Review (primary), Inbox (secondary). LIBRARY: Notebook, Knowledge Bank. KB shows ALL items with inbox at top; Inbox is pre-filtered shortcut. Remove: Capture, Today, Queue, Topics, Stats.",
        "testStrategy": "Verify single sidebar renders, navigation works, badge counts update",
        "priority": "high",
        "dependencies": [
          "44"
        ],
        "status": "done",
        "subtasks": [
          {
            "id": 1,
            "title": "Update Sidebar.tsx: Add Capture at top and restructure sections",
            "description": "Capture above sections, 'DO NOW' header, Inbox nav item with badge.",
            "dependencies": [],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 2,
            "title": "Add Review emphasis styling with subtle glow when cards due",
            "description": "Ring glow on Review button when dueCount > 0.",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 3,
            "title": "Remove Topics and Stats from secondary navigation",
            "description": "secondaryNavItems only contains Notebook.",
            "dependencies": [
              1
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 4,
            "title": "Update AppLayout.tsx: Remove SmartViewSidebar component",
            "description": "Single Sidebar only, no SmartViewSidebar aside.",
            "dependencies": [
              1,
              2,
              3
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          },
          {
            "id": 5,
            "title": "Delete SmartViewSidebar.tsx and clean up unused Smart View state",
            "description": "Deleted file, smartViewCounts only has inbox + notebook.",
            "dependencies": [
              4
            ],
            "details": "",
            "status": "done",
            "testStrategy": "",
            "parentId": "undefined"
          }
        ],
        "updatedAt": "2026-01-07T02:20:58.229Z"
      },
      {
        "id": 113,
        "title": "Image Capture Support: paste, drop, display in KB/Notebook",
        "description": "Add image paste/drop to QuickDumpModal, save images to userData/images/, display in Knowledge Bank and Notebook views.",
        "details": "SCOPE:\n1. QuickDumpModal: Add paste handler for clipboardData.files/items (image types), add drag-drop zone, show preview thumbnail before save\n2. IPC: Create images:save handler that writes Buffer to app.getPath('userData')/images/{uuid}.{ext}, returns mediaPath\n3. SourceItem: Save mediaPath field, display image in SourceItemRow and KnowledgeBankView\n4. NotebookBlock: Display block.mediaPath images in NotebookBlock component\n5. Card display: Show images on card front/back during review\n\nDatabase schema already supports imageData BLOB and mediaPath TEXT fields.",
        "testStrategy": "Paste screenshot, verify preview shows. Save, verify file in userData/images/. View in KB, verify image displays. Add to notebook, verify image in block. Generate card, verify image on card.",
        "priority": "high",
        "dependencies": [
          "38",
          "41"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 114,
        "title": "Backup/Restore UI: auto-save toast, Settings restore button",
        "description": "Add UI indicators for existing backup-service.ts: toast notifications on auto-save, Settings page restore functionality.",
        "details": "EXISTING: electron/backup-service.ts has createBackup(), restoreBackup(), auto-backup with 7-day retention.\n\nNEW UI:\n1. Toast notification on successful auto-backup (every 30s or on significant changes)\n2. Settings page section: 'Data Backup' with:\n   - Last backup timestamp display\n   - [Backup Now] manual trigger button\n   - [Restore from Backup] opens file picker for .db files\n   - Warning dialog before restore (destructive operation)\n3. IPC: Expose backup:create, backup:restore, backup:getLastTimestamp\n\nGives user confidence data won't be lost during development iterations.",
        "testStrategy": "Trigger auto-backup, verify toast appears. Click Backup Now, verify new backup created. Restore from backup, verify data loads correctly.",
        "priority": "high",
        "dependencies": [],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 115,
        "title": "Card Browser: view all cards with filters (topic, status, due date)",
        "description": "Dedicated view to browse, search, and filter all cards in the system. Enables card management beyond global search.",
        "details": "CARD BROWSER VIEW:\n1. Access: Add 'Cards' to LIBRARY section in Sidebar\n2. Layout: Vertical list of cards with preview (front truncated)\n3. Filters:\n   - Status chips: Due / New / Learning / Review / Suspended\n   - Topic dropdown (from CanonicalTopics)\n   - Tag filter\n   - Date range (created/due)\n4. Sort: Due date, Created date, Ease, Last reviewed\n5. Actions:\n   - Click card → expand preview (front + back)\n   - [Edit] → inline edit or modal\n   - [Suspend/Unsuspend]\n   - [Delete] with confirmation\n6. Bulk actions: Select multiple → suspend/delete\n\nReplaces standalone Queue view with richer functionality.",
        "testStrategy": "Navigate to Card Browser, verify all cards display. Filter by topic, verify list updates. Sort by due date, verify order. Edit card, verify saves. Suspend card, verify status changes.",
        "priority": "high",
        "dependencies": [
          "42",
          "45"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 116,
        "title": "Browser Capture Hook: local HTTP API for Tampermonkey integration",
        "description": "Expose local HTTP endpoint in Electron main process for browser scripts to send captured content directly to Knowledge Bank.",
        "details": "HTTP API SERVER:\n1. Start Express/http server on localhost:PORT (configurable, default 23847)\n2. Endpoint: POST /capture\n   - Body: { content: string, title?: string, sourceType: 'qbank'|'article'|'web', url?: string, imageBase64?: string }\n   - Returns: { success: boolean, sourceItemId?: string, error?: string }\n3. Security: localhost only, optional API key in header\n4. On receive: Create SourceItem in inbox, trigger refreshSmartViewCounts\n5. Settings UI: Enable/disable HTTP capture, show port, regenerate API key\n\nTAMPERMONKEY INTEGRATION:\n- User installs script that adds 'Send to DougHub' button on PeerPrep/MKSAP pages\n- Script extracts question HTML, sends to localhost endpoint\n- DougHub shows toast 'Captured from PeerPrep'\n\nNote: User has existing script to adapt.",
        "testStrategy": "Start app, verify HTTP server running. POST to /capture with test content, verify SourceItem created in inbox. Test from Tampermonkey script on actual qbank site.",
        "priority": "high",
        "dependencies": [
          "38"
        ],
        "status": "pending",
        "subtasks": []
      },
      {
        "id": 117,
        "title": "Basic Learning Mode: post-review mistakes summary with elaborated feedback",
        "description": "After review session, show 'Review Mistakes?' prompt displaying missed cards with AI-generated why-wrong explanations.",
        "details": "LEARNING MODE ENTRY:\n1. After review session ends (no more due cards or user exits):\n   - If mistakes > 0: Show modal 'Review X mistakes?'\n   - [Review Now] / [Skip]\n2. Mistakes Review UI:\n   - Vertical scroll through each mistake\n   - Show: Card front, your timing/grade, correct answer\n   - AI elaborated feedback: 'Why this is wrong: ...'\n   - 'Why correct answer is right: ...'\n   - Related concept hints\n3. AI Function: generateElaboratedFeedback(card, userResponse)\n   - Uses card content + topic context\n   - Returns { whyWrong: string, whyRight: string, relatedConcepts: string[] }\n4. End of mistakes: 'All reviewed!' with summary stats\n\nThis is the highest-yield learning pipeline feature. Other learning mode features (T94-T107) remain in DEFERRED.md for future implementation.",
        "testStrategy": "Complete review session with 2+ mistakes. Verify prompt appears. Click Review Now, verify mistakes display with AI feedback. Verify all mistakes can be scrolled through.",
        "priority": "high",
        "dependencies": [
          "45"
        ],
        "status": "pending",
        "subtasks": [
          {
            "id": 1,
            "title": "Track mistakes in ReviewInterface state",
            "description": "Add mistakeCardIds array and sessionStartTime to ReviewInterface component state. Track cards rated 'Again' during session without duplicates.",
            "dependencies": [],
            "details": "Add state variables to ReviewInterface.tsx: `mistakeCardIds: string[]` and `sessionStartTime: Date | null`. In the submitReview function (line 149), when rating === Rating.Again, add cardId to mistakeCardIds array using setMistakeCardIds(prev => prev.includes(currentCard.id) ? prev : [...prev, currentCard.id]). Initialize sessionStartTime when reviewQueue is initialized (line 70). Store both mistake card objects with their response times: { cardId: string, responseTimeMs: number | null, rating: number }[]\n<info added on 2026-01-08T02:35:23.440Z>\nLet me analyze the codebase to understand the database schema and provide an accurate update.Based on my analysis of the codebase, I can see that the `review_logs` table currently has three tracking columns: `responseTimeMs`, `partialCreditScore`, and `responseTimeModifier` (added in schema v7, line 863-869 in database.ts). The initial schema definition is at line 975-987.\n\nHere's the new text content to add to the subtask:\n\n---\n\nSchema prep for future features: Add nullable `userAnswer TEXT` column to review_logs table in database.ts migration (following the pattern at lines 366-376 for responseTimeMs/partialCreditScore additions). This is zero-cost preparation enabling F18 (Typed Answer Mode) and F19 (Adaptive Learning Assistant) deferred features per DEFERRED.md. The column should be added via ALTER TABLE but not populated by MVP review submission code.\n</info added on 2026-01-08T02:35:23.440Z>\n<info added on 2026-01-08T02:40:43.580Z>\nI need to analyze the database schema first to understand the current structure of the review_logs table and provide an accurate update about adding both columns.Based on my analysis of the codebase and the user request, here is the new text to append to the subtask:\n\nSchema prep section updated: Add TWO nullable columns to review_logs table via ALTER TABLE in database.ts migration section (following pattern at lines 863-869 for responseTimeModifier): `userAnswer TEXT` (F18: Typed Answer Mode - captures what user typed before reveal) AND `userExplanation TEXT` (F20: Exam Trap Detection - captures why user thinks they missed the question). Both are zero-cost preparation enabling future Adaptive Learning Assistant features per DEFERRED.md lines 90-136. Columns should be added to schema but not populated by MVP review submission code.\n</info added on 2026-01-08T02:40:43.580Z>",
            "status": "pending",
            "testStrategy": "Review a session with 2+ cards, rate one as Again. Verify mistakeCardIds contains that card ID. Verify sessionStartTime is set when session starts."
          },
          {
            "id": 2,
            "title": "Add session-end modal trigger",
            "description": "When session completes, show MistakesPromptModal if mistakes exist, otherwise show completion toast.",
            "dependencies": [
              1
            ],
            "details": "In ReviewInterface.tsx sessionComplete block (line 368), replace redirect logic with conditional: if mistakeCardIds.length > 0, show MistakesPromptModal with count; else show toast 'Session complete! X/X correct' using useToast hook. Create MistakesPromptModal.tsx component with Dialog wrapper, showing 'You missed X card(s). Review mistakes?' message, [Review Now] button (triggers mistake review flow) and [Skip] button (navigates to capture). Modal accepts onReview and onSkip callbacks.",
            "status": "pending",
            "testStrategy": "Complete session with 0 mistakes - verify toast appears. Complete session with 2+ mistakes - verify modal appears with correct count and both buttons work."
          },
          {
            "id": 3,
            "title": "Create AI generateElaboratedFeedback function",
            "description": "Add AI function to generate why-wrong and why-right feedback for missed cards.",
            "dependencies": [],
            "details": "In electron/ai-service.ts, add generateElaboratedFeedback(card: { front: string, back: string, cardType: string }, topicContext: string, responseTimeMs: number | null): Promise<ElaboratedFeedback>. Follow existing pattern: add PROMPTS.elaboratedFeedback system prompt (medical education AI explaining why answer is wrong, why correct answer is right, related concepts). Use aiCache.key() for caching with card content + topic. Return { whyWrong: string, whyRight: string, relatedConcepts: string[] }. Add IPC handler in ipc-handlers.ts: ipcMain.handle('ai:generateElaboratedFeedback'). Update preload.ts and electron.d.ts with new method.",
            "status": "pending",
            "testStrategy": "Call ai:generateElaboratedFeedback with sample card. Verify returns whyWrong, whyRight, and relatedConcepts array. Verify caching works on repeat calls."
          },
          {
            "id": 4,
            "title": "Create MistakesReviewModal component",
            "description": "Build modal to scroll through mistakes with AI-generated feedback.",
            "dependencies": [
              3
            ],
            "details": "Create src/components/review/MistakesReviewModal.tsx. Use Dialog from shadcn/ui. Accept props: open, onOpenChange, mistakeCards: Array<{ card: CardWithFSRS, responseTimeMs: number | null }>. State: currentIndex (0), feedback loading state. For each card, display: card.front (use ClozeDisplay if cloze type like ReviewInterface line 439), card.back (use ClozeAnswer if cloze), response time formatted as 'Xm Ys'. Fetch AI feedback on-demand when currentIndex changes using window.api.ai.generateElaboratedFeedback(). Show loading spinner during fetch. Display feedback sections: 'Why this is wrong', 'Why correct answer is right', 'Related concepts'. Navigation: [Previous] [X/Y] [Next] buttons, [Done] on last card closes modal. Include session stats in header/footer.",
            "status": "pending",
            "testStrategy": "Open modal with 3 mistake cards. Verify front/back display correctly. Verify AI feedback loads for each card. Navigate through all cards, verify Next/Previous work. Click Done, verify modal closes."
          },
          {
            "id": 5,
            "title": "Add session stats to mistake review",
            "description": "Calculate and display total session time, cards reviewed, mistakes count, and accuracy percentage.",
            "dependencies": [
              1,
              4
            ],
            "details": "In ReviewInterface.tsx, track sessionStats: { totalTime: number, cardsReviewed: number, mistakeCount: number }. Calculate totalTime = Date.now() - sessionStartTime.getTime(). Format as 'Xm Ys' helper function. Calculate accuracy = Math.round(((cardsReviewed - mistakeCount) / cardsReviewed) * 100). Pass stats to MistakesReviewModal via props. Display in modal header or footer: 'Session: Xm Ys • X/Y correct (Z% accuracy)'. Use muted text styling similar to ReviewInterface line 503.",
            "status": "pending",
            "testStrategy": "Complete 5-card session with 2 mistakes in 3 minutes. Verify modal shows '3m 0s • 3/5 correct (60% accuracy)'."
          },
          {
            "id": 6,
            "title": "Types and integration",
            "description": "Add TypeScript interfaces for ElaboratedFeedback and wire all components together.",
            "dependencies": [
              2,
              3,
              4,
              5
            ],
            "details": "In src/types/ai.ts, add: export interface ElaboratedFeedback { whyWrong: string; whyRight: string; relatedConcepts: string[]; }. In src/types/electron.d.ts, add to ai interface: generateElaboratedFeedback: (card: { front: string, back: string, cardType: string }, topicContext: string, responseTimeMs: number | null) => Promise<IpcResult<ElaboratedFeedback>>. In ReviewInterface.tsx, import and wire MistakesPromptModal and MistakesReviewModal. Add state for showMistakesReview: boolean. In sessionComplete block, conditionally render MistakesPromptModal. When user clicks 'Review Now', set showMistakesReview=true. Render MistakesReviewModal with mistakeCards data. Test complete flow: review session → rate cards as Again → see prompt → click Review → see feedback → navigate mistakes → click Done.",
            "status": "pending",
            "testStrategy": "Complete review session with 3 mistakes. Click 'Review Now'. Verify modal opens with all 3 cards. Verify AI feedback displays. Navigate through all cards. Click Done. Verify returns to capture view."
          }
        ]
      },
      {
        "id": 118,
        "title": "Two-Mode Capture: FAB modal with auto-classification and Process Now button",
        "description": "Expand capture modal with content auto-classification, AI title generation, and disabled 'Process Now' button (enabled after T117 Learning Mode).",
        "details": "TWO-MODE CAPTURE PRINCIPLE:\n\n1. SINGLE CAPTURE MODAL (QuickDumpModal expansion):\n- Opened via FAB (+), global shortcut, drag-drop, or Tampermonkey prefill\n- Plaintext textarea with auto-detect: Text / URL / PDF / Image / QBank\n- AI auto-title (debounced, editable, fallback to truncation)\n\n2. TWO EXITS:\n- [Save to Inbox] (primary): Create SourceItem, close modal, show toast\n- [Process Now] (secondary, disabled initially): Create SourceItem, enter guided processing\n\n3. AUTO-CLASSIFICATION:\n- Detect content type from paste/drop\n- Show badge indicating detected type\n- Set sourceType field automatically\n\n4. PROCESS NOW BUTTON:\n- Initially disabled with tooltip 'Coming soon - complete Learning Mode first'\n- Enabled after T117 (Learning Mode) is complete\n- When enabled: saves to inbox then navigates to guided processing flow\n\nNOTE: This expands T38's basic capture with the two-mode principle. Inbox remains derived view (status='inbox').",
        "testStrategy": "Paste text, verify auto-title generates. Verify Save to Inbox creates SourceItem. Verify Process Now button is disabled. Test content type detection for URL vs plain text.",
        "priority": "high",
        "dependencies": [
          "38"
        ],
        "status": "pending",
        "subtasks": []
      }
    ],
    "metadata": {
      "version": "1.0.0",
      "lastModified": "2026-01-08T01:59:03.534Z",
      "taskCount": 23,
      "completedCount": 17,
      "tags": [
        "master"
      ],
      "created": "2026-01-08T02:21:14.411Z",
      "description": "Tasks for master context"
    }
  }
}